<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.howaboutliving.dao.PublicDataEnvironmentDao">
<!-- 	<insert id="insertPublicDataEnvironment" -->
<!-- 		parameterType="com.howaboutliving.dto.PublicDataEnvironment"> -->
<!-- 		INSERT INTO environment_test(id, stationName, -->
<!-- 		dataTime,all_value,so2_value,co_value,o3_value,no2_value,finedust_value,ultrafinedust_value,all_grade,so2_grade,co_grade,o3_grade,no2_grade,finedust_grade,ultrafinedust_grade) -->
<!-- 		VALUES(0, #{stationName}, #{dataTime},#{all_value},#{so2_value},#{co_value},#{o3_value},#{no2_value},#{finedust_value},#{ultrafinedust_value},#{all_grade},#{so2_grade},#{co_grade},#{o3_grade},#{no2_grade},#{finedust_grade},#{ultrafinedust_grade}) -->
<!-- 	</insert> -->
	
	<insert id="insertPublicDataEnvironment"
		parameterType="String">
		INSERT INTO environment_test(id, stationName,
		dataTime,all_value,so2_value,co_value,o3_value,no2_value,finedust_value,ultrafinedust_value,all_grade,so2_grade,co_grade,o3_grade,no2_grade,finedust_grade,ultrafinedust_grade)
		VALUES(0, #{stationName}, #{dataTime},#{all_value},#{so2_value},#{co_value},#{o3_value},#{no2_value},#{finedust_value},#{ultrafinedust_value},#{all_grade},#{so2_grade},#{co_grade},#{o3_grade},#{no2_grade},#{finedust_grade},#{ultrafinedust_grade})
	</insert>
	
	
	<insert id="insertPublicDataEnvironmentAvg" parameterType="String">
		INSERT INTO environment_test
		(SELECT 0, CONCAT(CURDATE(), " ", #{str}) as date_time, station_name, ROUND(AVG(all_value), 0) as all_value, ROUND(AVG(so2_value), 3) as so2_value, ROUND(AVG(co_value), 1) as co_value, ROUND(AVG(o3_value), 3) as o3_value, ROUND(AVG(no2_value), 3) as no2_value,
		ROUND(AVG(finedust_value), 0) as finedust_value, ROUND(AVG(ultra_finedust_value), 0) as ultra_finedust_value, ROUND(AVG(all_grade), 0) as all_grade, ROUND(AVG(so2_grade), 0) as so2_grade, ROUND(AVG(co_grade), 0) as co_grade, 
		ROUND(AVG(o3_grade), 0) as o3_grade, ROUND(AVG(no2_grade), 0) as no2_grade, ROUND(AVG(finedust_grade), 0) as finedust_grade, ROUND(AVG(ultra_finedust_grade), 0) as ultra_finedust_grade
		FROM environment
		WHERE data_time like CONCAT('%',#{str})
		GROUP BY station_name)
	</insert >

	<delete id="deletePublicDataEnvironment"
		parameterType="com.howaboutliving.dto.PublicDataEnvironment">
		DELETE FROM environment
	</delete>

	<update id="autoIncrementReset">
		ALTER TABLE environment AUTO_INCREMENT = 1
	</update>
</mapper>